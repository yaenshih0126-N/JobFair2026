<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DHL é–ƒé›»åˆ†æ€å“¡ - å°ˆæ¥­æ‰“æ«ƒç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #FFCC00; /* DHL é»ƒ */
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            touch-action: none;
            height: 100vh;
            width: 100vw;
            margin: 0;
        }
        .dhl-red { color: #D40000; }
        .bg-dhl-red { background-color: #D40000; }
        
        #game-container {
            height: 100%;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* é ‚éƒ¨è³‡è¨Šå€ */
        header {
            height: 70px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 50;
            padding-top: 10px;
        }

        /* éŸ³æ¨‚æ§åˆ¶æŒ‰éˆ• */
        #music-toggle {
            position: absolute;
            top: 20px;
            right: 15px;
            background: rgba(212, 0, 0, 0.1);
            border: 2px solid #D40000;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 100;
            font-size: 1.2rem;
        }

        /* éŠæˆ²ä½œæ¥­å€ */
        #work-area {
            flex-grow: 1;
            width: 100%;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 40;
        }

        /* é©é…æ‰‹æ©Ÿæ¯”ä¾‹çš„ç´™ç®± */
        .package {
            width: 240px; 
            min-height: 180px; 
            background: #FFCC00; 
            border: 3px solid #333; 
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: absolute;
            box-shadow: 6px 6px 0px rgba(0,0,0,0.1); 
            z-index: 100;
            padding: 12px;
            text-align: center;
            pointer-events: auto;
        }

        .package::after {
            content: '';
            position: absolute;
            bottom: 15px;
            left: 0;
            width: 100%;
            height: 8px;
            background: #D40000; 
            border-top: 2px solid #333;
            border-bottom: 2px solid #333;
        }

        .label-area {
            background: white;
            border: 2px solid #333;
            border-radius: 6px;
            padding: 12px;
            width: 95%;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
            z-index: 10;
        }

        /* åº•éƒ¨æ«ƒä½å€ */
        footer {
            height: 190px; 
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            padding: 0 15px 20px 15px;
            z-index: 30;
        }

        .pallet-wrap {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 46%;
        }

        .pallet-container {
            width: 100%;
            height: 130px;
            background: rgba(255, 255, 255, 0.35);
            border: 3px solid #D40000;
            border-top: none;
            border-radius: 0 0 12px 12px;
            display: flex;
            flex-direction: column-reverse; 
            align-items: center;
            padding-bottom: 5px;
            overflow: hidden;
        }

        .stacked-box {
            width: 90%;
            height: 20px;
            background: #FFCC00; 
            border: 1px solid #333;
            margin-bottom: 1px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 900;
            color: #D40000;
            border-radius: 3px;
            animation: dropIn 0.3s ease-out;
        }

        .pallet-label {
            width: 100%;
            text-align: center;
            font-weight: 900;
            color: #D40000;
            font-size: 0.85rem;
            background: white;
            padding: 6px;
            border: 2px solid #D40000;
            border-radius: 10px;
            margin-bottom: 6px;
            box-shadow: 2px 2px 0px rgba(0,0,0,0.1);
        }

        #timer-bar {
            position: fixed;
            top: 0;
            left: 0;
            height: 6px;
            background: #D40000;
            width: 100%;
            z-index: 200;
            transition: width 0.1s linear;
        }

        #explanation-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 500;
        }

        .hidden { display: none !important; }

        @keyframes dropIn {
            0% { transform: translateY(-50px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }

        .shake { animation: shake 0.4s ease-in-out; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-8px); }
            40%, 80% { transform: translateX(8px); }
        }
    </style>
</head>
<body>

    <div id="timer-bar"></div>
    <div id="music-toggle">ğŸ”‡</div>

    <div id="game-container">
        <!-- é–‹å§‹ç•«é¢ -->
        <div id="start-screen" class="w-full h-full flex flex-col items-center justify-center p-6 z-[200] absolute bg-[#FFCC00]">
            <h1 class="text-4xl font-black dhl-red mb-1 italic">DHL EXPRESS</h1>
            <h2 class="text-xl font-bold mb-8 text-gray-800">å°ˆæ¥­æ‰“æ«ƒæŒ‘æˆ°è³½</h2>
            <div class="bg-white p-8 rounded-3xl shadow-2xl max-w-xs w-full text-center border-4 border-black">
                <div class="w-20 h-16 bg-[#FFCC00] mx-auto mb-6 border-2 border-black relative flex items-center justify-center rounded">
                    <span class="font-black text-red-600 italic text-lg">DHL</span>
                </div>
                <p class="text-base text-gray-700 mb-8 font-bold leading-relaxed">æŒ‘æˆ°ä¸å¯èƒ½ä»»å‹™ï¼<br>å·¦å³æ»‘å‹•ç´™ç®±å®Œæˆåˆ†æ€ã€‚</p>
                <button id="start-btn" class="w-full bg-dhl-red text-white py-4 rounded-2xl text-xl font-bold shadow-[0_5px_0_#990000] active:translate-y-1 active:shadow-none">
                    å•Ÿå‹•ä»»å‹™
                </button>
            </div>
        </div>

        <!-- éŠæˆ²ä¸»ç•«é¢ -->
        <div id="game-play" class="hidden flex flex-col h-full w-full">
            <header>
                <div class="text-gray-600 font-bold text-xs uppercase tracking-widest">Efficiency Score</div>
                <div id="score" class="text-4xl font-black dhl-red">0</div>
            </header>

            <div id="work-area"></div>

            <footer>
                <div class="pallet-wrap">
                    <div id="left-label" class="pallet-label">A</div>
                    <div id="left-pallet" class="pallet-container"></div>
                </div>
                <div class="pallet-wrap">
                    <div id="right-label" class="pallet-label">B</div>
                    <div id="right-pallet" class="pallet-container"></div>
                </div>
            </footer>
        </div>

        <!-- ç­”æ¡ˆè§£æç•«é¢ -->
        <div id="explanation-overlay" class="hidden">
            <div class="bg-white w-10/12 max-w-sm rounded-3xl border-4 border-black p-6 shadow-2xl">
                <div id="result-indicator" class="text-2xl font-black mb-3 italic">CORRECT!</div>
                <div class="h-1 bg-gray-100 mb-4"></div>
                <p id="explanation-text" class="text-gray-700 text-base font-medium leading-relaxed mb-6"></p>
                <button id="next-task-btn" class="w-full bg-dhl-red text-white py-4 rounded-xl font-black text-lg shadow-[0_4px_0_#990000] active:translate-y-1 active:shadow-none">
                    ä¸‹ä¸€å€‹ä»»å‹™
                </button>
            </div>
        </div>

        <!-- çµç®—ç•«é¢ -->
        <div id="result-screen" class="hidden w-full h-full flex flex-col items-center justify-center p-6 z-[300] absolute bg-[#FFCC00]">
            <h2 class="text-3xl font-black dhl-red mb-4 italic text-center">ä»»å‹™å®Œæˆï¼</h2>
            <div class="bg-white p-8 rounded-3xl shadow-2xl max-w-xs w-full text-center border-4 border-black">
                <p class="text-sm text-gray-600 font-bold uppercase tracking-wider">ç©è¼‰æ•ˆç‡ç¸½è©•åˆ†</p>
                <div id="final-score" class="text-7xl font-black mb-2 dhl-red">0</div>
                <p id="rank-text" class="text-xl font-bold text-yellow-600 mb-8"></p>
                
                <button onclick="window.location.reload()" class="w-full bg-gray-800 text-white py-4 rounded-xl font-bold mb-4 shadow-[0_4px_0_#333] active:translate-y-1 active:shadow-none">é‡æ–°æŒ‘æˆ°</button>
                <button id="join-team-btn" class="w-full bg-dhl-red text-white py-4 rounded-xl font-bold shadow-[0_4px_0_#990000] active:translate-y-1 active:shadow-none">åŠ å…¥å“è¶Šåœ˜éšŠ</button>
            </div>
        </div>
    </div>

    <script>
        // æ›´æ–°å¾Œçš„é¡Œç›®å…§å®¹
        const questions = [
            { q: "DHLæ˜¯åœ¨å“ªè£¡æˆç«‹çš„ï¼Ÿ", left: "A. èˆŠé‡‘å±±", right: "B. è¾›è¾›é‚£æ", correct: "left", desc: "DHLæ–¼1969å¹´åœ¨èˆŠé‡‘å±±æˆç«‹ï¼Œè¾›è¾›é‚£æå‰‡æ˜¯DHLåœ¨ç¾æ´²çš„ä¸»è¦è½‰é‹ä¸­å¿ƒã€‚" },
            { q: "DHL ä¸»è¦çš„æ¥­å‹™æ˜¯ä»€éº¼ï¼Ÿ", left: "A. ç‰©æµæœå‹™", right: "B. å¤–é€æœå‹™", correct: "left", desc: "DHLæ˜¯ç‰©æµæ¥­çš„é ˜å°å“ç‰Œï¼Œè‡´åŠ›æ–¼æä¾›é«˜å“è³ªç‰©æµæœå‹™ï¼Œä¸¦é‹ç”¨æœ€æ–°ç§‘æŠ€ã€å¼•é ˜æ°¸çºŒç‰©æµç™¼å±•ï¼Œå¯¦è¸ã€Œé€£çµäººç¾¤ï¼Œæ”¹å–„ç”Ÿæ´»ã€çš„ä¼æ¥­å®—æ—¨ã€‚" },
            { q: "DHL å“ç‰Œåç¨±çš„ç”±ä¾†ï¼Ÿ", left: "A. Deliver Happiness and Love", right: "B. å‰µè¾¦äººçš„å§“æ°é¦–å­—ç¸®å¯«", correct: "right", desc: "DHLç‚ºä¸‰ä½å‰µè¾¦äººAdrian Dalsey, Larry Hillblomå’ŒRobert Lynnçš„å§“æ°é¦–å­—çµ„æˆã€‚" },
            { q: "DHL çš„é›†åœ˜ç›®æ¨™ç‚ºï¼Ÿ", left: "A. 2030å¹´é›†åœ˜ç¦ç”¨å¡‘è† åŒ…æ", right: "B. 2050å¹´é”æˆæ·¨é›¶ç¢³æ’", correct: "right", desc: "DHLéå¸¸é‡è¦–ç’°ä¿ï¼Œé›†åœ˜ç›®æ¨™ç‚ºåœ¨2050å¹´é”åˆ°æ·¨é›¶ç¢³æ’ï¼Œç›®å‰ä¹Ÿå·²æ¨å‡ºæ°¸çºŒç‰©æµçš„æœå‹™ï¼Œç‚ºåœ°çƒç›¡ä¸€ä»½å¿ƒåŠ›ã€‚" },
            { q: "DHLçš„logoé¡è‰²ç‚ºï¼Ÿ", left: "A. è—è‰²å’Œç¶ è‰²", right: "B. é»ƒè‰²å’Œç´…è‰²", correct: "right", desc: "DHL æˆç«‹åˆæœŸï¼Œlogoç‚ºç´…ç™½è‰²ï¼Œéš¨è‘—æ™‚ä»£æ¼”é€²ï¼Œè½‰è®Šç‚ºæ›´èƒ½å¼·èª¿é‡‘é»ƒè‰²é€Ÿåº¦çš„ç´…é»ƒå“ç‰Œè‰²ã€‚" }
        ];

        let score = 0;
        let timeLeft = 30;
        let gameActive = false;
        let timerPaused = false;
        let currentPackage = null;
        let startX = 0;
        let questionIndex = 0;

        // --- é€²éšéŸ³æ¨‚ç³»çµ± (Mission Impossible Style) ---
        let audioCtx = null;
        let isMusicPlaying = false;
        let nextNoteTime = 0;
        const tempo = 175; 
        const lookahead = 25.0;
        const scheduleAheadTime = 0.1;
        let beat = 0;

        const musicBtn = document.getElementById('music-toggle');
        musicBtn.addEventListener('click', toggleMusic);

        function initAudio() {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }

        function toggleMusic() {
            initAudio();
            isMusicPlaying = !isMusicPlaying;
            musicBtn.innerText = isMusicPlaying ? "ğŸ”Š" : "ğŸ”‡";
            if (isMusicPlaying) {
                if (audioCtx.state === 'suspended') audioCtx.resume();
                nextNoteTime = audioCtx.currentTime;
                scheduler();
            }
        }

        // æ¨¡æ“¬ä½éŸ³é¼“ (Kick)
        function playKick(time) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.frequency.setValueAtTime(150, time);
            osc.frequency.exponentialRampToValueAtTime(0.01, time + 0.1);
            gain.gain.setValueAtTime(0.5, time);
            gain.gain.exponentialRampToValueAtTime(0.01, time + 0.1);
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(time); osc.stop(time + 0.1);
        }

        // æ¨¡æ“¬å°é¼“/æ‰“æ“Šæ„Ÿ (Snare/Click)
        function playSnare(time) {
            const noise = audioCtx.createBufferSource();
            const buffer = audioCtx.createBuffer(1, audioCtx.sampleRate * 0.05, audioCtx.sampleRate);
            const data = buffer.getChannelData(0);
            for (let i = 0; i < data.length; i++) data[i] = Math.random() * 2 - 1;
            noise.buffer = buffer;
            const gain = audioCtx.createGain();
            gain.gain.setValueAtTime(0.1, time);
            gain.gain.exponentialRampToValueAtTime(0.01, time + 0.05);
            noise.connect(gain); gain.connect(audioCtx.destination);
            noise.start(time);
        }

        // åˆæˆæ—‹å¾‹éŸ³è‰²
        function playSynthNote(time, freq, dur, vol = 0.1) {
            const osc1 = audioCtx.createOscillator();
            const osc2 = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            
            osc1.type = 'sawtooth'; // é‹¸é½’æ³¢å¢åŠ åšåº¦
            osc2.type = 'square';   // æ–¹æ³¢å¢åŠ é›»å­æ„Ÿ
            osc1.frequency.setValueAtTime(freq, time);
            osc2.frequency.setValueAtTime(freq / 2, time); // ä½å…«åº¦ç–ŠåŠ 
            
            gain.gain.setValueAtTime(vol, time);
            gain.gain.exponentialRampToValueAtTime(0.001, time + dur);
            
            osc1.connect(gain); osc2.connect(gain);
            gain.connect(audioCtx.destination);
            
            osc1.start(time); osc2.start(time);
            osc1.stop(time + dur); osc2.stop(time + dur);
        }

        function nextNote() {
            const secondsPerBeat = 60.0 / tempo;
            // MI ç¯€å¥: 1(G), 1(G), 0.5(Bb), 0.5(C) -> ç¸½å’Œ 3 æ‹å¾ªç’°åšè®Šå¥
            const rhythm = [1, 1, 0.5, 0.5];
            nextNoteTime += rhythm[beat % 4] * secondsPerBeat;
            beat++;
        }

        function scheduleNote(beatNum, time) {
            const step = beatNum % 4;
            const measure = Math.floor(beatNum / 8); // æ¯ 8 å€‹éŸ³ç¬¦ç®—ä¸€å€‹æ¨‚å¥

            // æ¯æ‹éƒ½æœ‰ Kick å¢åŠ ç¯€å¥æ„Ÿ
            if (step === 0 || step === 1) playKick(time);
            if (step === 2 || step === 3) playSnare(time);

            // æ—‹å¾‹éš¨å°ç¯€è®Šå¥
            let freq = 98; // G2
            if (step === 2) freq = 116.5; // Bb2
            if (step === 3) freq = 130.8; // C3

            // æ¯å››å°ç¯€å‡å…«åº¦å¢åŠ æƒ…ç·’
            if (measure % 4 === 3) freq *= 2; 
            
            playSynthNote(time, freq, step < 2 ? 0.3 : 0.15, 0.08);
        }

        function scheduler() {
            while (isMusicPlaying && nextNoteTime < audioCtx.currentTime + scheduleAheadTime) {
                scheduleNote(beat, nextNoteTime);
                nextNote();
            }
            if (isMusicPlaying) setTimeout(scheduler, lookahead);
        }

        // --- éŠæˆ²é‚è¼¯ ---
        const startBtn = document.getElementById('start-btn');
        const nextTaskBtn = document.getElementById('next-task-btn');
        const workArea = document.getElementById('work-area');
        const scoreDisplay = document.getElementById('score');
        const leftPallet = document.getElementById('left-pallet');
        const rightPallet = document.getElementById('right-pallet');
        const expOverlay = document.getElementById('explanation-overlay');
        const joinBtn = document.getElementById('join-team-btn');

        startBtn.addEventListener('click', startGame);
        nextTaskBtn.addEventListener('click', hideExplanation);

        joinBtn.addEventListener('click', () => {
            window.open("https://careers.dhl.com/global/en", "_blank");
        });

        function startGame() {
            initAudio();
            if (audioCtx.state === 'suspended') audioCtx.resume();
            if (!isMusicPlaying) toggleMusic(); 
            
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-play').classList.remove('hidden');
            gameActive = true;
            spawnQuestion();
            startTimer();
        }

        function startTimer() {
            const timerBar = document.getElementById('timer-bar');
            const interval = setInterval(() => {
                if (!gameActive) { clearInterval(interval); return; }
                if (!timerPaused) {
                    timeLeft -= 0.1;
                    timerBar.style.width = (timeLeft / 30 * 100) + '%';
                    if (timeLeft <= 0) endGame();
                }
            }, 100);
        }

        function spawnQuestion() {
            if (!gameActive || questionIndex >= questions.length) return;
            const data = questions[questionIndex];
            document.getElementById('left-label').innerText = data.left;
            document.getElementById('right-label').innerText = data.right;

            const pkg = document.createElement('div');
            pkg.className = 'package';
            pkg.innerHTML = `<div class="label-area"><div class="text-lg font-black text-gray-800 leading-tight">${data.q}</div></div>`;
            workArea.appendChild(pkg);
            currentPackage = pkg;

            const handleStart = (x) => { if(!timerPaused) startX = x; };
            const handleMove = (x) => {
                if (!currentPackage || timerPaused) return;
                const diff = x - startX;
                currentPackage.style.transform = `translateX(${diff}px) rotate(${diff/12}deg)`;
            };
            const handleEnd = (x) => {
                if (!currentPackage || timerPaused) return;
                const diff = x - startX;
                if (diff < -65) validate('left');
                else if (diff > 65) validate('right');
                else {
                    currentPackage.style.transition = 'transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
                    currentPackage.style.transform = 'translateX(0) rotate(0)';
                    setTimeout(() => { if(currentPackage) currentPackage.style.transition = ''; }, 300);
                }
            };

            pkg.addEventListener('touchstart', (e) => handleStart(e.touches[0].clientX), {passive: true});
            pkg.addEventListener('touchmove', (e) => { e.preventDefault(); handleMove(e.touches[0].clientX); }, {passive: false});
            pkg.addEventListener('touchend', (e) => handleEnd(e.changedTouches[0].clientX));
            pkg.addEventListener('mousedown', (e) => {
                handleStart(e.clientX);
                const onMM = (me) => handleMove(me.clientX);
                const onMU = (ue) => {
                    handleEnd(ue.clientX);
                    window.removeEventListener('mousemove', onMM);
                    window.removeEventListener('mouseup', onMU);
                };
                window.addEventListener('mousemove', onMM);
                window.addEventListener('mouseup', onMU);
            });
        }

        function validate(choice) {
            const data = questions[questionIndex];
            const isCorrect = choice === data.correct;
            const targetPallet = choice === 'left' ? leftPallet : rightPallet;
            timerPaused = true; 

            if (isCorrect) {
                score += 20;
                currentPackage.style.transition = 'all 0.4s ease-in';
                currentPackage.style.transform = `translate(${choice === 'left' ? -180 : 180}px, 350px) scale(0.1)`;
                currentPackage.style.opacity = '0';
                setTimeout(() => addStackedBox(targetPallet), 300);
            } else {
                score = Math.max(0, score - 10);
                currentPackage.style.transition = 'all 0.5s ease-out';
                currentPackage.style.transform = `translateY(600px) rotate(90deg)`;
                currentPackage.style.opacity = '0';
                document.body.classList.add('shake');
                setTimeout(() => document.body.classList.remove('shake'), 400);
            }
            scoreDisplay.innerText = score;
            showExplanation(isCorrect, data.desc);
        }

        function showExplanation(isCorrect, text) {
            const ind = document.getElementById('result-indicator');
            ind.innerText = isCorrect ? "ç­”å°äº†ï¼" : "ç­”éŒ¯äº†...";
            ind.className = isCorrect ? "text-2xl font-black mb-3 text-green-600 italic" : "text-2xl font-black mb-3 text-red-600 italic";
            document.getElementById('explanation-text').innerText = text;
            setTimeout(() => expOverlay.classList.remove('hidden'), 500);
        }

        function hideExplanation() {
            expOverlay.classList.add('hidden');
            if (currentPackage) currentPackage.remove();
            currentPackage = null;
            questionIndex++;
            timerPaused = false;
            if (questionIndex >= questions.length) endGame();
            else spawnQuestion();
        }

        function addStackedBox(pallet) {
            const box = document.createElement('div');
            box.className = 'stacked-box';
            box.innerText = `ğŸ“¦ OK`;
            pallet.appendChild(box);
        }

        function endGame() {
            gameActive = false;
            isMusicPlaying = false; 
            document.getElementById('game-play').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
            document.getElementById('final-score').innerText = score;
            let rank = score >= 100 ? "ğŸ† ç‰¹ç´šæ‰“æ«ƒå¤§å¸«" : (score >= 60 ? "ğŸšš å°ˆæ¥­ç‰©æµå£«" : "ğŸ“¦ å¯¦ç¿’ç†è²¨å“¡");
            document.getElementById('rank-text').innerText = rank;
        }
    </script>
</body>
</html>
